<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>THINKBIG</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
      .wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        grid-template-rows: 200px 200px 200px 250px;
        grid-gap: 10px;
        margin-right :10px;
        margin-left: 10px;
      }
      .item:nth-child(1) {
        grid-column-start: 1;
        grid-column-end: 4;
        grid-row-start: 1;
        grid-row-end: 2;
      }
      .item:nth-child(2) {
        grid-column-start: 1;
        grid-column-end: 4;
        grid-row-start: 1;
        grid-row-end: 2;
      }
      .item:nth-child(2) {
        grid-column-start: 1;
        grid-column-end: 4;
        grid-row-start: 2;
        grid-row-end: 4;
      }
      .item:nth-child(3) {
        grid-column-start: 1;
        grid-column-end: 4;
        grid-row-start: 4;
        grid-row-end: 5;
      }
      .item:nth-child(4) {
        grid-column-start: 4;
        grid-column-end: 6;
        grid-row-start: 1;
        grid-row-end: 3;
      }
      .item:nth-child(5) {
        grid-column-start: 4;
        grid-column-end: 6;
        grid-row-start: 3;
        grid-row-end: 5;
      }
    
    </style>
  </head>
  <body>
    <!--woongjin_boys-->
    <nav class="navbar navbar-expand-lg navbar-flame bg-flame">
      <span style="font: italic bold 1.5em/1em Georgia, serif">
        <a class="navbar-brand" href="#!" style="color: black">Woonjin_boys</a>
      </span>
    </nav>
    <div class="wrapper">
      <!--첫번째 칸 __ 참여자 얼굴-->
      <div
        class="item"
        style="border: 5px double black; border-radius: 10px; text-align: center;"
      > 
      <img style ="border-radius: 10px; margin : 5px;  border: 3px solid black; margin-right: 5px;"
      src="{{ url_for('video_feed', peer='1') }}"
      width="23%"
      height="90%"
    />
    <img style ="border-radius: 10px; margin : 5px; border: 3px solid black; "
      src="{{ url_for('video_feed', peer='2') }}"
      width="23%"
      height="90%"
    />
    <img style ="border-radius: 10px; margin : 5px; border: 3px solid black; "
      src="{{ url_for('video_feed', peer='3') }}"
      width="23%"
      height="90%"
    />
    <img style ="border-radius: 10px; margin : 5px; border: 3px solid black; "
      src="{{ url_for('video_feed', peer='4') }}"
      width="23%"
      height="90%"
    />
    <br /></div>

      <!--두번째 칸 __ 발화자 얼굴-->
      <div class="item" style="border: 3px solid black; border-radius: 10px">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"><strong>발화자</strong></a>
          </div>
        </nav>
        <div style ="text-align: center;">
        <img style ="border: 5px double black;border-radius: 10px; margin : 5px; margin-top: 10px;"
        src="{{ url_for('video_feed', peer='1') }}"
        width="50%"
        height="80%"
      />
      </div>
      </div>

      <!--세번째 칸 __ 발화 기록-->
      <div class="item" style="border: 3px solid black; border-radius: 10px">
        <nav class="navbar sticky-top navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"
              ><strong>학생들의 발화 기록</strong></a
            >
            <form
              action="http://localhost:5000/mfccend"
              method="POST"
              target="_blank"
            >
              <input
                type="submit"
                name="button"
                class="btn btn-success"
                style="background-color: rgb(211, 62, 8)"
                value="Refresh"
              />
            </form>
          </div>
        </nav>
        <h3 id="SpeakingRate1"></h3>
        <h3 id="SpeakingRate2"></h3>
        <h3 id="SpeakingRate3"></h3>
        <h3 id="SpeakingRate4"></h3>
        <h3 id="SpeakingCount1"></h3>
        <h3 id="SpeakingCount2"></h3>
        <h3 id="SpeakingCount3"></h3>
        <h3 id="SpeakingCount4"></h3>
        <br />
        <script>
          var board = document.getElementById("png");
          let temp = "temp";

          setInterval(function () {
            $.ajax({
              url: "/mfcc_feed",
              type: "POST",
              success: function (response) {
                console.log("first response : ");
                console.log(response);
                if (response["SpeakingRate1"] !== "0.0") {
                  $("#SpeakingRate1").html(
                    "<학생 1> 발화율 : " +  response["SpeakingRate1"] + "%, 발화 횟수" + response["SpeakingCount1"] + "회"
                  );
                }
                if (response["SpeakingRate2"] !== "0.0") {
                  $("#SpeakingRate2").html(
                    "<학생 2> 발화율 : " +  response["SpeakingRate2"] + "%, 발화 횟수" + response["SpeakingCount2"] + "회"
                  );
                }
                if (response["SpeakingRate3"] !== "0.0") {
                  $("#SpeakingRate3").html(
                    "<학생 3> 발화율 : " +  response["SpeakingRate3"] + "%, 발화 횟수" + response["SpeakingCount3"] + "회"
                  );
                }
                if (response["SpeakingRate4"] !== "0.0") {
                  $("#SpeakingRate4").html(
                    "<학생 4> 발화율 : " +  response["SpeakingRate4"] + "%, 발화 횟수" + response["SpeakingCount4"] + "회"
                  );
                }
              },
              error: function (error) {
                console.log(error);
              },
            });
          }, 1000);
        </script>
      </div>

      <!--네번째 칸 __ 내 얼굴-->
      <div class="item" style="border-radius: 10px; border: 3px solid black">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"><strong>내 얼굴</strong></a>
          </div>
        </nav> 
        <div style ="text-align: center;">
          <img style ="border: 5px double black;border-radius: 10px; margin-top: 20px;"
          src="{{ url_for('justWebCAM_feed') }}"
          width="72%"
          height="84%"
        />
        </div>
      </div>

      <!--다섯번째 칸 학생들의 행동 기록-->
        <div
          class="item"
          style="
            overflow-x: hidden;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            border: 3px solid black;
          "
        >
          <nav class="navbar sticky-top navbar-dark bg-dark">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">
                <strong>학생들의 행동 기록</strong></a
              >            
          </nav>
          <div id="record"></div>
        <script>
          var body = document.getElementById("record");
          let arr,
            startTime,
            endTime,
            behaviorType,
            overlap = "None",
            behavior_setting;

          setInterval(function () {
            $.ajax({
              url: "/log_feed",
              type: "POST",
              success: function (response) {
                console.log(response);
                console.log("test : " + response["startTime"]);
                if (
                  response["startTime"] !== "0" &&
                  response["startTime"] !== overlap
                ) {
                  //이상 행동 발생시 버튼 생성
                  var button = document.createElement("button");
                  //버튼 디자인
                  button.style.cssText =
                    "border-radius : 10px; background-color : white; width :100%; text-align : center ";
                  //behaviorType 결정
                  behaviorType = response["behaviorType"];
                  if (behaviorType === "0") {
                    behavior_setting = "눈 감음";
                  } else if (behaviorType === "1") {
                    behavior_setting = "고개 기울임";
                  } else {
                    behavior_setting = "얼굴 멀어짐";
                  }
                  //제대로 수정해야한다
                  var starttime = response["startTime"].slice(0, 3);
                  var endtime = response["endTime"].slice(0, 3);
                  button.innerHTML =
                    "학생 " +
                    response["name"] +
                    "의 " +
                    starttime +
                    "초 부터 " +
                    endtime +
                    "초 까지 " +
                    "<br/>" +
                    behavior_setting +
                    " 감지됨";
                  body.appendChild(button);
                  overlap = response["startTime"];
                }
              },
              error: function (error) {
                console.log(error);
              },
            });
          }, 1000);
        </script>
        </div>      
    </div>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
