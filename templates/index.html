<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>THINKBIG</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <link href="css/styles.css" rel="stylesheet" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
      #if {
        width: 0px;
        height: 0px;
        border: 0px;
      }
      .container {
        gap: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        grid-template-rows: 200px 250px 200px 200px;
      }
      .item:nth-child(1) {
        grid-column-start: 1;
        grid-column-end: 3;
        grid-row-start: 1;
        grid-row-end: 2;
      }
      .item:nth-child(2) {
        grid-column-start: 3;
        grid-column-end: 5;
        grid-row-start: 1;
        grid-row-end: 3;
      }
      .item:nth-child(3) {
        grid-column-start: 1;
        grid-column-end: 3;
        grid-row-start: 2;
        grid-row-end: 4;
      }
      .item:nth-child(4) {
        grid-column-start: 1;
        grid-column-end: 3;
        grid-row-start: 4;
        grid-row-end: 5;
      }
      .item:nth-child(5) {
        grid-column-start: 3;
        grid-column-end: 5;
        grid-row-start: 3;
        grid-row-end: 5;
      }
      .align_img {
        display: block;
        margin-right: 20px;
        float: left;
        background-color: black;
        /*margin-top: 40px;*/
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-flame bg-flame">
      <div class="container px-5">
        <span style="font: italic bold 1.5em/1em Georgia, serif">
          <a class="navbar-brand" href="#!" style="color: black"
            >Woonjin_boys</a
          >
        </span>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </nav>

    <div class="container">
      <!-- 첫 번째 칸 -->
      <div class="item" style="margin-top: 5px; border: 3px solid black">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"><strong>학생들 얼굴</strong></a>
          </div>
        </nav>
        <img
          src="{{ url_for('video_feed', peer='1') }}"
          width="125px"
          height="125px"
        />
        <img
          src="{{ url_for('video_feed', peer='2') }}"
          width="125px"
          height="125px"
        />
        <img
          src="{{ url_for('video_feed', peer='3') }}"
          width="125px"
          height="125px"
        />
        <img
          src="{{ url_for('video_feed', peer='4') }}"
          width="125px"
          height="125px"
        />
        <br />
      </div>

      <!-- 두번째 칸 -->
      <div class="item" style="margin-top: 5px; border: 3px solid black">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"><strong>내 얼굴</strong></a>
          </div>
        </nav>
        <img
          src="{{ url_for('justWebCAM_feed') }}"
          width="100%"
          height="100%"
        />
        <br />
      </div>

      <!--세번째 칸-->
      <div class="item" style="margin-top: 5px; border: 3px solid black">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"
              ><strong>선생님,발화자 얼굴</strong></a
            >
          </div>
        </nav>
        <img
          src="{{ url_for('video_feed', peer='1') }}"
          width="100%"
          height="400px"
        />
        <br />
      </div>

      <!--네번째 칸-->
      <div
        class="item"
        style="
          overflow-x: hidden;
          width: 100%;
          height: 280px;
          margin-top: 5px;
          border: 3px solid black;
        "
      >
        <nav class="navbar sticky-top navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#"
              ><strong>학생들의 발화 기록</strong></a
            >
            <form
              action="http://localhost:5000/mfccstart"
              method="POST"
              target="_blank"
            >
              <input
                type="submit"
                name="button"
                class="btn btn-success"
                value="MFCC Start"
              />
            </form>
            <form
              action="http://localhost:5000/mfccend"
              method="POST"
              target="_blank"
            >
              <input
                type="submit"
                name="button"
                class="btn btn-success"
                style="background-color: rgb(211, 62, 8)"
                value="MFCC Stop"
              />
            </form>
          </div>
        </nav>

        <h3 id="SpeakingRate1"></h3>
        <h3 id="SpeakingRate2"></h3>
        <h3 id="SpeakingRate3"></h3>
        <h3 id="SpeakingRate4"></h3>
        <br />
        <script>
          var board = document.getElementById("png");
          let temp = "temp";

          setInterval(function () {
            $.ajax({
              url: "/mfcc_feed",
              type: "POST",
              success: function (response) {
                console.log("first response : ");
                console.log(response);
                if (response["SpeakingRate1"] !== "0.0") {
                  $("#SpeakingRate1").html(
                    "Student1 speaking rate : " +
                      response["SpeakingRate1"] +
                      "%"
                  );
                }
                if (response["SpeakingRate2"] !== "0.0") {
                  $("#SpeakingRate2").html(
                    "Student2 speaking rate : " +
                      response["SpeakingRate2"] +
                      "%"
                  );
                }
                if (response["SpeakingRate3"] !== "0.0") {
                  $("#SpeakingRate3").html(
                    "Student3 speaking rate : " +
                      response["SpeakingRate3"] +
                      "%"
                  );
                }
                if (response["SpeakingRate4"] !== "0.0") {
                  $("#SpeakingRate4").html(
                    "Student4 speaking rate : " +
                      response["SpeakingRate4"] +
                      "%"
                  );
                }
              },
              error: function (error) {
                console.log(error);
              },
            });
          }, 1000);
        </script>
      </div>

      <!--다섯번째 칸-->
      <div
        class="item"
        style="
          overflow-x: hidden;
          width: 100%;
          height: 500px;
          margin-top: 5px;
          border: 3px solid black;
        "
      >
        <nav class="navbar sticky-top navbar-dark bg-dark">
          <div class="container-fluid">
            <a class="navbar-brand" href="#">
              <strong>학생들의 행동 기록</strong></a
            >
          </div>
        </nav>
        <br />
        <h4 id="record"></h4>
        <script>
          var body = document.getElementById("record");
          let arr,
            startTime,
            endTime,
            behaviorType,
            overlap = "None",
            behavior_setting;

          setInterval(function () {
            $.ajax({
              url: "/log_feed",
              type: "POST",
              success: function (response) {
                console.log(response);
                console.log("test : " + response["startTime"]);
                if (
                  response["startTime"] !== "0" &&
                  response["startTime"] !== overlap
                ) {
                  //이상 행동 발생시 버튼 생성
                  var button = document.createElement("button");
                  //버튼 디자인
                  button.style.cssText =
                    "border-radius : 10px; background-color : white ";
                  //behaviorType 결정
                  if (behaviorType == "0") {
                    behavior_setting = "눈 감음";
                  } else if (behaviorType == "1") {
                    behavior_setting = "고개 기울임";
                  } else {
                    behavior_setting = "얼굴 멀어짐";
                  }
                  //제대로 수정해야한다
                  var starttime = response["startTime"].slice(0, 3);
                  var endtime = response["endTime"].slice(0, 3);
                  button.innerHTML =
                    "학생 " +
                    response["name"] +
                    "의 " +
                    starttime +
                    "초 부터 " +
                    endtime +
                    "초 까지 " +
                    "<br/>" +
                    behavior_setting +
                    " 감지됨";
                  body.appendChild(button);
                  overlap = response["startTime"];
                }
              },
              error: function (error) {
                console.log(error);
              },
            });
          }, 1000);
        </script>
      </div>
    </div>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
